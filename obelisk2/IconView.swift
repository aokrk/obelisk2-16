


//  Created by 青木陸 on 2021/03/21.
//
import SwiftUI

struct IconView: View {
    
    @Environment (\.isFirstLaunch) var isPresentedModally
    
    @State private var image: Image = Image("icon")
    @State private var showingImagePicker = false
    @State private var inputImage: UIImage?
    
    var body: some View {
      
        
        
        VStack {
Text("アイコンを設定").font(.system(size: 40,weight: .heavy))
            
            
            
            Button(action: {
                print("Tapped")
                self.showingImagePicker = true
            }) {
                image
                    
                    
                    
                    
                    .resizable()
                    .scaledToFill()
                    .clipShape(Circle())
                    .frame(width: 300, height: 300)
                   
                   
                 
                
                
                
                
                Text("画像をタップして登録")
            }.fullScreenCover(isPresented: $showingImagePicker, onDismiss: loadImage) {
                ImagePicker(image: self.$inputImage)
                
                
                
            }
            
            
            
            
            
Button(action: {self.isPresentedModally.wrappedValue = false}, label: {
Text("アイコンを設定せずに登録完了/登録完了").fontWeight(.bold)}
)
            Spacer()
        }
        
        
    }
     
    func loadImage() {
        guard let inputImage = inputImage else { return }
        image = Image(uiImage: inputImage)
    }
}





























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































struct ImagePicker: UIViewControllerRepresentable {
    @Environment(\.presentationMode) var presentationMode
    @Binding var image: UIImage?
    
    class Coordinator: NSObject, UINavigationControllerDelegate, UIImagePickerControllerDelegate {
        let parent: ImagePicker
        
        init(_ parent: ImagePicker) {
            self.parent = parent
        }
        
        func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [UIImagePickerController.InfoKey: Any]) {
            if let uiImage = info[.originalImage] as? UIImage {
                parent.image = uiImage
            }
            
            parent.presentationMode.wrappedValue.dismiss()
        }
    }
    
    func makeCoordinator() -> Coordinator {
        Coordinator(self)
    }
    
    func makeUIViewController(context: UIViewControllerRepresentableContext<ImagePicker>) -> UIImagePickerController {
        let picker = UIImagePickerController()
        picker.delegate = context.coordinator
        return picker
    }
    
    func updateUIViewController(_ uiViewController: UIImagePickerController, context: UIViewControllerRepresentableContext<ImagePicker>) {

    }
}


struct IconView_Previews: PreviewProvider {
    static var previews: some View {
        IconView()
    }
}
